# ebookjapan-cart-filter

ebookjapan のカートページ (`/cart/`) にラベルごとのフィルターパネルを表示する Chrome 拡張です。  
「カゴに入れる」「あとで買う」でリストが動的に変化しても、ラベル別にフィルタリング・再描画されます。

## 機能

- 画面左中央にフィルターパネルを追加
- カート内に存在するラベルごとにボタンを自動生成  
  - 例: `NEW`, `◯◯%OFF`, `◯◯%獲得`, `ラベルなし`
- ボタンを押すと、そのラベルを持つコミックのみを表示
- **「全て展開」** ボタンで折りたたまれている商品を一括展開
- **「リセット」** ボタンでフィルタ解除
- SPA 遷移に対応  
  - `/cart/` に入ると自動でパネルが表示され、他画面では非表示
- 選択中のラベルは青系の強調表示で常時わかるように表示
- 処理中はボタンが半透明＋無効化され「sync…」バッジで通知

## 動作対象

- Chrome（Manifest V3 対応）
- 対象ページ: `https://ebookjapan.yahoo.co.jp/cart/`

## インストール方法

1. このリポジトリをクローン、または ZIP をダウンロードして展開
2. Chrome の拡張機能管理ページ（`chrome://extensions/`）を開く
3. 「デベロッパーモード」をオンにする
4. 「パッケージ化されていない拡張機能を読み込む」からフォルダを選択

## 仕組み（How it works）

- **起動判定**  
  - URL が `/cart/` または `/cart` に一致  
  - かつ `#cartContents` / `.cart-contents` 内に `li.cart-item` または `li.later-item` が存在  
  → この二重条件を満たした場合のみフィルターパネルをブートします。  

- **パネル生成**  
  - `content.js` 内で DOM に直接パネルを追加  
  - ボタンは現在表示されている商品を走査し、各商品のラベル（`.tagtext`）を集計して動的に生成  

- **フィルタ処理**  
  - 商品要素にカスタム属性 `data-ejcf-labels` を付与  
  - 選択中のラベルに一致しない商品には `.ejcf-hidden` を付与し CSS で非表示化  

- **動的更新への対応**  
  - `MutationObserver` でカート全体を監視  
  - 「あとで買う」や「カゴに入れる」で DOM が変わるたびに再抽出・ボタン更新・再フィルタリング  

- **SPA 遷移対応**  
  - `history.pushState`, `replaceState`, `popstate` をフック  
  - `location.href` のポーリング、`MutationObserver` も併用  
  - 遷移検知ごとに `/cart/` かどうかを判定して `boot()` または `teardown()` を実行  

- **UI 表現**  
  - 選択中ボタンには青系の枠・左バー・背景で常時ハイライト  
  - 処理中は全ボタンを無効化＋半透明＋「sync…」バッジ表示  

## 開発メモ

- バージョン: `v1.2.6`
- パネルは DOM と URL の両方を厳密にチェックして `/cart/` でのみ起動
- メイン処理: `content.js`
- スタイルは content.js 内にインライン定義済み

# ebookjapan_cart_extension2
